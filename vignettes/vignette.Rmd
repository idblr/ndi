---
title: 'ndi: Neighborhood Deprivation Indices'
author: 'Ian D. Buller (GitHub: @idblr)'
date: '`r Sys.Date()`'
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ndi: Neighborhood Deprivation Indices}
  %\VignetteEngine{R.rsp::asis}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
library(knitr)
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, cache = FALSE, fig.show = 'hold')
```

Start with the necessary packages for the vignette.

```{r packages, results = 'hide'}
loadedPackages <- c('dplyr', 'ggplot2', 'ndi', 'sf', 'tidycensus', 'tigris')
invisible(lapply(loadedPackages, library, character.only = TRUE))
options(tigris_use_cache = TRUE)
```

Set your U.S. Census Bureau access key. Follow [this link](http://api.census.gov/data/key_signup.html) to obtain one. Specify your access key in the `messer()` or `powell_wiley()` functions using the `key` argument of the `get_acs()` function from the [*tidycensus*](https://CRAN.R-project.org/package=tidycensus) package called within each or by using the `census_api_key()` function from the [*tidycensus*](https://CRAN.R-project.org/package=tidycensus) package before running the `messer()` or `powell_wiley()` functions (see an example of the latter below).

```{r access_key_private, echo = FALSE}
source(file.path('..', 'dev', 'private_key.R'))
census_api_key(private_key)
```

```{r access_key_public, eval = FALSE}
census_api_key('...') # INSERT YOUR OWN KEY FROM U.S. CENSUS API
```

### Compute *NDI* (Messer)

Compute the *NDI* (Messer) values (2006-2010 5-year ACS) for Georgia, U.S.A., census tracts. This metric is based on [Messer et al. (2006)](https://doi.org/10.1007/s11524-006-9094-x) with the following socio-economic status (SES) variables: 

| Characteristic | SES dimension | ACS table source | Description |
| -------------- | ------------- | ---------------- | ----------- |
| OCC | Occupation | C24030 | Percent males in management, science, and arts occupation |
| CWD | Housing | B25014 | Percent of crowded housing |
| POV | Poverty | B17017 | Percent of households in poverty |
| FHH | Poverty | B25115 | Percent of female headed households with dependents |
| PUB | Poverty | B19058 | Percent of households on public assistance |
| U30 | Poverty | B19001 | Percent households earning <$30,000 per year |
| EDU | Education | B06009 | Percent earning less than a high school education |
| EMP | Employment | B23001 (2010 only); B23025 (2011 onward) | Percent unemployed |

```{r messer, results = 'hide'}
messer2010GA <- messer(state = 'GA', year = 2010, round_output = TRUE)
```

One output from the `messer()` function is a tibble containing the identification, geographic name, *NDI* (Messer) values, and raw census characteristics for each tract.

```{r messer_out1}
messer2010GA$ndi
```

A second output from the `messer()` function is the results from the principal component analysis used to compute the *NDI* (Messer) values.

```{r messer_out2}
messer2010GA$pca
```

A third output from the `messer()` function is a tibble containing a breakdown of the missingness of the census characteristics used to compute the *NDI* (Messer) values.

```{r messer_out3}
messer2010GA$missing
```

We can visualize the *NDI* (Messer) values geographically by linking them to spatial information from the [*tigris*]([*tidycensus*](https://CRAN.R-project.org/package=tigris) package and plotting with the [*ggplot2*]([*tidycensus*](https://CRAN.R-project.org/package=ggplot2) package suite.

```{r messer_prep, results = 'hide'}
# Obtain the 2010 counties from the 'tigris' package
county2010GA <- counties(state = 'GA', year = 2010, cb = TRUE)
# Remove first 9 characters from GEOID for compatibility with tigris information
county2010GA$GEOID <- substring(county2010GA$GEO_ID, 10) 

# Obtain the 2010 census tracts from the 'tigris' package
tract2010GA <- tracts(state = 'GA', year = 2010, cb = TRUE)
# Remove first 9 characters from GEOID for compatibility with tigris information
tract2010GA$GEOID <- substring(tract2010GA$GEO_ID, 10) 

# Join the NDI (Messer) values to the census tract geometry
GA2010messer <- tract2010GA %>%
  left_join(messer2010GA$ndi, by = 'GEOID')
```

```{r messer_plot, fig.height = 7, fig.width = 7}
# Visualize the NDI (Messer) values (2006-2010 5-year ACS) for Georgia, U.S.A., census tracts 
## Continuous Index
ggplot() +
  geom_sf(
    data = GA2010messer,
    aes(fill = NDI),
    size = 0.05,
    color = 'transparent'
  ) +
  geom_sf(
    data = county2010GA,
    fill = 'transparent',
    color = 'white',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_viridis_c() +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2006-2010 estimates') +
  ggtitle(
    'Neighborhood Deprivation Index (Messer)',
    subtitle = 'GA census tracts as the referent'
  )

## Categorical Index
### Rename '9-NDI not avail' level as NA for plotting
GA2010messer$NDIQuartNA <-
  factor(
    replace(
      as.character(GA2010messer$NDIQuart),
      GA2010messer$NDIQuart == '9-NDI not avail',
      NA
    ),
    c(levels(GA2010messer$NDIQuart)[-5], NA)
  )

ggplot() +
  geom_sf(
    data = GA2010messer,
    aes(fill = NDIQuartNA),
    size = 0.05,
    color = 'transparent'
  ) +
  geom_sf(
    data = county2010GA,
    fill = 'transparent',
    color = 'white',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_viridis_d(guide = guide_legend(reverse = TRUE), na.value = 'grey80') +
  labs(fill = 'Index (Categorical)', caption = 'Source: U.S. Census ACS 2006-2010 estimates') +
  ggtitle(
    'Neighborhood Deprivation Index (Messer) Quartiles',
    subtitle = 'GA census tracts as the referent'
  )
```

The results above are at the tract level. The *NDI* (Messer) values can also be calculated at the county level. 

```{r messer_county_prep, results = 'hide'}
messer2010GA_county <- messer(geo = 'county', state = 'GA', year = 2010)

# Join the NDI (Messer) values to the county geometry
GA2010messer_county <- county2010GA %>%
  left_join(messer2010GA_county$ndi, by = 'GEOID')
```

```{r messer_county_plot, fig.height = 7, fig.width = 7}
# Visualize the NDI (Messer) values (2006-2010 5-year ACS) for Georgia, U.S.A., counties
## Continuous Index
ggplot() +
  geom_sf(
    data = GA2010messer_county,
    aes(fill = NDI),
    size = 0.20,
    color = 'white'
  ) +
  theme_minimal() +
  scale_fill_viridis_c() +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2006-2010 estimates') +
  ggtitle(
    'Neighborhood Deprivation Index (Messer)',
    subtitle = 'GA counties as the referent'
  )

## Categorical Index

### Rename '9-NDI not avail' level as NA for plotting
GA2010messer_county$NDIQuartNA <-
  factor(
    replace(
      as.character(GA2010messer_county$NDIQuart),
      GA2010messer_county$NDIQuart == '9-NDI not avail',
      NA
    ),
    c(levels(GA2010messer_county$NDIQuart)[-5], NA)
  )

ggplot() +
  geom_sf(
    data = GA2010messer_county,
    aes(fill = NDIQuartNA),
    size = 0.20,
    color = 'white'
  ) +
  theme_minimal() +
  scale_fill_viridis_d(guide = guide_legend(reverse = TRUE), na.value = 'grey80') +
  labs(fill = 'Index (Categorical)', caption = 'Source: U.S. Census ACS 2006-2010 estimates') +
  ggtitle(
    'Neighborhood Deprivation Index (Messer) Quartiles',
    subtitle = 'GA counties as the referent'
  )
```

### Compute *NDI* (Powell-Wiley)

Compute the *NDI* (Powell-Wiley) values (2016-2020 5-year ACS) for Maryland, Virginia, Washington, D.C., and West Virginia, U.S.A., census tracts. This metric is based on [Andrews et al. (2020)](https://doi.org/10.1080/17445647.2020.1750066) and [Slotman et al. (2022)](https://doi.org/10.1016/j.dib.2022.108002) with socio-economic status (SES) variables chosen by [Roux and Mair (2010)](https://doi.org/10.1111/j.1749-6632.2009.05333.x):

| Characteristic | SES dimension | ACS table source | Description |
| -------------- | ------------- | ---------------- | ----------- |
| MedHHInc | Wealth and income | B19013 | Median household income (dollars) |
| PctRecvIDR | Wealth and income | B19054 | Percent of households receiving dividends, interest, or rental income |
| PctPubAsst | Wealth and income | B19058 | Percent of households receiving public assistance |
| MedHomeVal | Wealth and income | B25077 | Median home value (dollars) |
| PctMgmtBusSciArt | Occupation | C24060 | Percent in a management, business, science, or arts occupation |
| PctFemHeadKids | Occupation | B11005 | Percent of households that are female headed with any children under 18 years |
| PctOwnerOcc | Housing conditions | DP04 | Percent of housing units that are owner occupied |
| PctNoPhone | Housing conditions | DP04 | Percent of households without a telephone |
| PctNComPlmb | Housing conditions | DP04 | Percent of households without complete plumbing facilities |
| PctEducHSPlus | Education | S1501 | Percent with a high school degree or higher (population 25 years and over) |
| PctEducBchPlus | Education | S1501 | Percent with a college degree or higher (population 25 years and over) |
| PctFamBelowPov | Wealth and income | S1702 | Percent of families with incomes below the poverty level |
| PctUnempl | Occupation | S2301 | Percent unemployed |

More information about the [codebook](https://gis.cancer.gov/research/NeighDeprvIndex_Methods.pdf) and [computation](https://gis.cancer.gov/research/NeighDeprvIndex_Methods.pdf) of the *NDI* (Powell-Wiley) can be found on a [GIS Portal for Cancer Research](https://gis.cancer.gov/research/files.html#soc-dep) website.

```{r powell_wiley, results = 'hide'}
powell_wiley2020DMVW <- powell_wiley(
  state = c('DC', 'MD', 'VA', 'WV'),
  year = 2020,
  round_output = TRUE
)
```

One output from the `powell_wiley()` function is a tibble containing the identification, geographic name, *NDI* (Powell-Wiley) values, and raw census characteristics for each tract.

```{r powell_wiley_out1}
powell_wiley2020DMVW$ndi
```

A second output from the `powell_wiley()` function is the results from the principal component analysis used to compute the *NDI* (Powell-Wiley) values.

```{r powell_wiley_out2}
powell_wiley2020DMVW$pca
```

A third output from the `powell_wiley()` function is a tibble containing a breakdown of the missingness of the census characteristics used to compute the *NDI* (Powell-Wiley) values.

```{r powell_wiley_out3}
powell_wiley2020DMVW$missing
```

A fourth output from the `powell_wiley()` function is a character string or numeric value of a standardized Cronbach's alpha. A value greater than 0.7 is desired.

```{r powell_wiley_out4}
powell_wiley2020DMVW$cronbach
```

We can visualize the *NDI* (Powell-Wiley) values geographically by linking them to spatial information from the [*tigris*]([*tidycensus*](https://CRAN.R-project.org/package=tigris) package and plotting with the [*ggplot2*]([*tidycensus*](https://CRAN.R-project.org/package=ggplot2) package suite.

```{r powell_wiley_prep, results = 'hide'}
# Obtain the 2020 counties from the 'tigris' package
county2020 <- counties(cb = TRUE)
county2020DMVW <- county2020[county2020$STUSPS %in% c('DC', 'MD', 'VA', 'WV'), ]

# Obtain the 2020 census tracts from the 'tigris' package
tract2020D <- tracts(state = 'DC', year = 2020, cb = TRUE)
tract2020M <- tracts(state = 'MD', year = 2020, cb = TRUE)
tract2020V <- tracts(state = 'VA', year = 2020, cb = TRUE)
tract2020W <- tracts(state = 'WV', year = 2020, cb = TRUE)
tracts2020DMVW <- rbind(tract2020D, tract2020M, tract2020V, tract2020W)

# Join the NDI (Powell-Wiley) values to the census tract geometry
DMVW2020pw <- tracts2020DMVW %>%
  left_join(powell_wiley2020DMVW$ndi, by = 'GEOID')
```

```{r powell_wiley_plot, fig.height = 4, fig.width = 7}
# Visualize the NDI (Powell-Wiley) values (2016-2020 5-year ACS) 
## Maryland, Virginia, Washington, D.C., and West Virginia, U.S.A., census tracts 
## Continuous Index
ggplot() +
  geom_sf(
    data = DMVW2020pw,
    aes(fill = NDI),
    color = NA
  ) +
  geom_sf(
    data = county2020DMVW,
    fill = 'transparent',
    color = 'white'
  ) +
  theme_minimal() +
  scale_fill_viridis_c(na.value = 'grey80') +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2016-2020 estimates') +
  ggtitle(
    'Neighborhood Deprivation Index (Powell-Wiley)',
    subtitle = 'DC, MD, VA, and WV tracts as the referent'
  )

## Categorical Index (Population-weighted quintiles)
### Rename '9-NDI not avail' level as NA for plotting
DMVW2020pw$NDIQuintNA <-
  factor(replace(
    as.character(DMVW2020pw$NDIQuint),
    DMVW2020pw$NDIQuint == '9-NDI not avail',
    NA
  ),
  c(levels(DMVW2020pw$NDIQuint)[-6], NA))

ggplot() +
  geom_sf(data = DMVW2020pw, aes(fill = NDIQuintNA), color = NA) +
  geom_sf(data = county2020DMVW, fill = 'transparent', color = 'white') +
  theme_minimal() +
  scale_fill_viridis_d(guide = guide_legend(reverse = TRUE), na.value = 'grey80') +
  labs(fill = 'Index (Categorical)', caption = 'Source: U.S. Census ACS 2016-2020 estimates') +
  ggtitle(
    'Neighborhood Deprivation Index (Powell-Wiley) Population-weighted Quintiles',
    subtitle = 'DC, MD, VA, and WV tracts as the referent'
  )
```

Like the *NDI* (Messer), we also compute county-level *NDI* (Powell-Wiley).

```{r powell_wiley_county_prep, results = 'hide'}
# Obtain the 2020 counties from the 'tigris' package
county2020DMVW <- counties(state = c('DC', 'MD', 'VA', 'WV'), year = 2020, cb = TRUE)

# NDI (Powell-Wiley) at the county level (2016-2020)
powell_wiley2020DMVW_county <- powell_wiley(
  geo = 'county',
  state = c('DC', 'MD', 'VA', 'WV'),
  year = 2020
)

# Join the NDI (Powell-Wiley) values to the county geometry
DMVW2020pw_county <- county2020DMVW %>%
  left_join(powell_wiley2020DMVW_county$ndi, by = 'GEOID')
```

```{r powell_wiley_county_plot, fig.height = 4, fig.width = 7}
# Visualize the NDI (Powell-Wiley) values (2016-2020 5-year ACS)
## Maryland, Virginia, Washington, D.C., and West Virginia, U.S.A., counties
## Continuous Index
ggplot() +
  geom_sf(
    data = DMVW2020pw_county,
    aes(fill = NDI),
    size = 0.20,
    color = 'white'
  ) +
  theme_minimal() +
  scale_fill_viridis_c() +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2016-2020 estimates') +
  ggtitle(
    'Neighborhood Deprivation Index (Powell-Wiley)',
    subtitle = 'DC, MD, VA, and WV counties as the referent'
  )

## Categorical Index

### Rename '9-NDI not avail' level as NA for plotting
DMVW2020pw_county$NDIQuintNA <-
  factor(
    replace(
      as.character(DMVW2020pw_county$NDIQuint),
      DMVW2020pw_county$NDIQuint == '9-NDI not avail',
      NA
    ),
    c(levels(DMVW2020pw_county$NDIQuint)[-6], NA)
  )

ggplot() +
  geom_sf(
    data = DMVW2020pw_county,
    aes(fill = NDIQuint),
    size = 0.20,
    color = 'white'
  ) +
  theme_minimal() +
  scale_fill_viridis_d(guide = guide_legend(reverse = TRUE), na.value = 'grey80') +
  labs(fill = 'Index (Categorical)', caption = 'Source: U.S. Census ACS 2016-2020 estimates') +
  ggtitle(
    'Neighborhood Deprivation Index (Powell-Wiley) Population-weighted Quintiles',
    subtitle = 'DC, MD, VA, and WV counties as the referent'
  )
```

### Advanced Features

#### Imputing missing census variables

In the `messer()` and `powell_wiley()` functions, missing census characteristics can be imputed using the `missing` and `impute` arguments of the `pca()` function in the [*psych*](https://CRAN.R-project.org/package=psych) package called within the `messer()` and `powell_wiley()` functions. Impute values using the logical `imp` argument (currently only calls `impute = 'median'` by default, which assigns the median values of each missing census variable for a geography).

```{r powell_wiley_imp, results = 'hide'}
powell_wiley2020DC <- powell_wiley(state = 'DC', year = 2020) # without imputation
powell_wiley2020DCi <- powell_wiley(state = 'DC', year = 2020, imp = TRUE) # with imputation

table(is.na(powell_wiley2020DC$ndi$NDI)) # n=13 tracts without NDI (Powell-Wiley) values
table(is.na(powell_wiley2020DCi$ndi$NDI)) # n=0 tracts without NDI (Powell-Wiley) values

# Obtain the 2020 census tracts from the 'tigris' package
tract2020DC <- tracts(state = 'DC', year = 2020, cb = TRUE)

# Join the NDI (Powell-Wiley) values to the census tract geometry
DC2020pw <- tract2020DC %>%
  left_join(powell_wiley2020DC$ndi, by = 'GEOID')
DC2020pw <- DC2020pw %>%
  left_join(powell_wiley2020DCi$ndi, by = 'GEOID', suffix = c('_nonimp', '_imp'))
```

```{r powell_wiley_imp_plot, fig.height = 7, fig.width = 7}
# Visualize the NDI (Powell-Wiley) values (2016-2020 5-year ACS) for 
## Washington, D.C., census tracts
## Continuous Index
ggplot() +
  geom_sf(
    data = DC2020pw,
    aes(fill = NDI_nonimp),
    size = 0.2,
    color = 'white'
  ) +
  theme_minimal() +
  scale_fill_viridis_c() +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2016-2020 estimates') +
  ggtitle(
    'Neighborhood Deprivation Index (Powell-Wiley), Non-Imputed',
    subtitle = 'DC census tracts as the referent'
  )

ggplot() +
  geom_sf(
    data = DC2020pw,
    aes(fill = NDI_imp),
    size = 0.2,
    color = 'white'
  ) +
  theme_minimal() +
  scale_fill_viridis_c() +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2016-2020 estimates') +
  ggtitle(
    'Neighborhood Deprivation Index (Powell-Wiley), Imputed',
    subtitle = 'DC census tracts as the referent'
  )

## Categorical Index
### Rename '9-NDI not avail' level as NA for plotting
DC2020pw$NDIQuintNA_nonimp <-
  factor(
    replace(
      as.character(DC2020pw$NDIQuint_nonimp),
      DC2020pw$NDIQuint_nonimp == '9-NDI not avail',
      NA
    ),
    c(levels(DC2020pw$NDIQuint_nonimp)[-6], NA)
  )

ggplot() +
  geom_sf(
    data = DC2020pw,
    aes(fill = NDIQuintNA_nonimp),
    size = 0.2,
    color = 'white'
  ) +
  theme_minimal() +
  scale_fill_viridis_d(guide = guide_legend(reverse = TRUE), na.value = 'grey80') +
  labs(fill = 'Index (Categorical)', caption = 'Source: U.S. Census ACS 2016-2020 estimates') +
  ggtitle(
    'Neighborhood Deprivation Index (Powell-Wiley) Quintiles, Non-Imputed',
    subtitle = 'DC census tracts as the referent'
  )

### Rename '9-NDI not avail' level as NA for plotting
DC2020pw$NDIQuintNA_imp <-
  factor(
    replace(
      as.character(DC2020pw$NDIQuint_imp),
      DC2020pw$NDIQuint_imp == '9-NDI not avail',
      NA
    ),
    c(levels(DC2020pw$NDIQuint_imp)[-6], NA)
  )

ggplot() +
  geom_sf(
    data = DC2020pw,
    aes(fill = NDIQuintNA_imp),
    size = 0.2,
    color = 'white'
  ) +
  theme_minimal() +
  scale_fill_viridis_d(guide = guide_legend(reverse = TRUE), na.value = 'grey80') +
  labs(fill = 'Index (Categorical)', caption = 'Source: U.S. Census ACS 2016-2020 estimates') +
  ggtitle(
    'Neighborhood Deprivation Index (Powell-Wiley) Quintiles, Imputed',
    subtitle = 'DC census tracts as the referent'
  )
```

#### Assign the referent (U.S.-Standardized Metric)

To conduct a contiguous US-standardized index, compute an *NDI* for all states as in the example below that replicates the nationally standardized *NDI* (Powell-Wiley) values (2013-2017 ACS-5) found in [Slotman et al. (2022)](https://doi.org/10.1016/j.dib.2022.108002) and available from a [GIS Portal for Cancer Research](https://gis.cancer.gov/research/files.html#soc-dep) website. To replicate the nationally standardized *NDI* (Powell-Wiley) values (2006-2010 ACS-5) found in [Andrews et al. (2020)](https://doi.org/10.1080/17445647.2020.1750066) change the `year` argument to `2010` (i.e., `year = 2010`).

```{r national_prep, results = 'hide'}
us <- states()
n51 <- c(
  'Commonwealth of the Northern Mariana Islands',
  'Guam',
  'American Samoa',
  'Puerto Rico',
  'United States Virgin Islands'
)
y51 <- us$STUSPS[!(us$NAME %in% n51)]

start_time <- Sys.time() # record start time
powell_wiley2017US <- powell_wiley(state = y51, year = 2017)
end_time <- Sys.time() # record end time
time_srr <- end_time - start_time # Calculate run time
```

```{r national_hist, fig.height = 7, fig.width = 7}
ggplot(powell_wiley2017US$ndi, aes(x = NDI)) +
  geom_histogram(color = 'black', fill = 'white') +
  theme_minimal() +
  ggtitle(
    'Histogram of US-standardized NDI (Powell-Wiley) values (2013-2017)',
    subtitle = 'U.S. census tracts as the referent (including AK, HI, and DC)'
  )
```

The process to compute a US-standardized *NDI* (Powell-Wiley) took about `r round(time_srr, digits = 1)` minutes to run on a machine with the features listed at the end of the vignette.

### Additional metrics socio-economic deprivation and disparity 

Since version v0.1.1, the [*ndi*](https://CRAN.R-project.org/package=ndi) package can compute additional metrics of socio-economic deprivation and disparity beyond neighborhood deprivation indices with data from the ACS-5, including:

1. `anthopolos()` function that computes the Racial Isolation Index (*RI*) based on [Anthopolos et al. (2011)](https://doi.org/10.1016/j.sste.2011.06.002)
2. `bravo()` function that computes the Educational Isolation Index (*EI*) based on [Bravo et al. (2021)](https://doi.org/10.3390/ijerph18179384)
3. `gini()` function that computes the Gini Index (*G*) of racial or ethnic inequality and retrieves the Gini Index (*G*) of income inequality based on [Gini (1921)](https://doi.org/10.2307/2223319) 
4. `krieger()` function that computes the Index of Concentration at the Extremes (*ICE*) based on based on [Feldman et al. (2015)](https://doi.org/10.1136/jech-2015-205728) and [Krieger et al. (2016)](https://doi.org/10.2105/AJPH.2015.302955)
5. `duncan()` function that computes the Dissimilarity Index (*D*) based on [Duncan & Duncan (1955)](https://doi.org/10.2307/2088328)
6. `atkinson()` function that computes the Atkinson Index (*A*) based on [Atkinson (1970)](https://doi.org/10.1016/0022-0531(70)90039-6)
7. `bell()` function that computes the racial or ethnic Interaction Index (_xPy\*_) based on Shevky & Williams (1949; ISBN-13:978-0-837-15637-8) and [Bell (1954)](https://doi.org/10.2307/2574118)
8. `white()` function that computes the racial or ethnic Correlation Ratio (*V*) based on [Bell (1954)](https://doi.org/10.2307/2574118) and [White (1986)](https://doi.org/10.2307/3644339)
9. `sudano()` function that computes the racial or ethnic Location Quotient (*LQ*) based on [Merton (1939)](https://doi.org/10.2307/2084686) and [Sudano et al. (2013)](https://doi.org/10.1016/j.healthplace.2012.09.015)
10. `bemanian_beyer()` function that computes the racial or ethnic Local Exposure and Isolation (*LEx/Is*) metric based on [Bemanian & Beyer (2017)](https://doi.org/10.1158/1055-9965.EPI-16-0926)
11. `hoover()` function that computes the racial or ethnic Delta (*DEL*) based on [Hoover (1941)](https://doi.org/10.1017/S0022050700052980) and Duncan et al. (1961; LC:60007089)
12. `white_blau()` function that computes an index of spatial proximity (*SP*) based on [White (1986)](https://doi.org/10.2307/3644339) and Blau (1977; ISBN-13:978-0-029-03660-0)
13. `lieberson()` function that computes the racial or ethnic Isolation Index (_xPx\*_) based on Lieberson (1981; ISBN-13:978-1-032-53884-6) and [Bell (1954)](https://doi.org/10.2307/2574118)
14. `james_taeuber()` function that computes the Dissimilarity Index (*D*) based on based on [James & Taeuber (1985)](https://doi.org/10.2307/270845)
15. `theil()` function that computes the racial or ethnic Entropy (*H*) based on Theil (1972; ISBN:978-0-444-10378-9) and [Theil & Finizza (1971)](https://doi.org/110.1080/0022250X.1971.9989795)

#### Compute Racial Isolation Index (*RI*)

Compute the spatial *RI*  values (2006-2010 5-year ACS) for North Carolina, U.S.A., census tracts. This metric is based on [Anthopolos et al. (2011)](https://doi.org/10.1016/j.sste.2011.06.002) that assessed the racial isolation of the population that identifies as non-Hispanic or Latino, Black or African American alone. Multiple racial or ethnic subgroups are available in the `anthopolos()` function, including:

| ACS table source | racial or ethnic subgroup | character for `subgroup` argument |
| -------------- | ------------- | ---------------- |
| B03002_002 | not Hispanic or Latino | NHoL |
| B03002_003 | not Hispanic or Latino, white alone | NHoLW |
| B03002_004 | not Hispanic or Latino, Black or African American alone | NHoLB |
| B03002_005 | not Hispanic or Latino, American Indian and Alaska Native alone | NHoLAIAN |
| B03002_006 | not Hispanic or Latino, Asian alone | NHoLA |
| B03002_007 | not Hispanic or Latino, Native Hawaiian and Other Pacific Islander alone | NHoLNHOPI |
| B03002_008 | not Hispanic or Latino, some other race alone | NHoLSOR |
| B03002_009 | not Hispanic or Latino, two or more races | NHoLTOMR |
| B03002_010 | not Hispanic or Latino, two races including some other race | NHoLTRiSOR |
| B03002_011 | not Hispanic or Latino, two races excluding some other race, and three or more races | NHoLTReSOR |
| B03002_012 | Hispanic or Latino | HoL |
| B03002_013 | Hispanic or Latino, white alone | HoLW |
| B03002_014 | Hispanic or Latino, Black or African American alone | HoLB |
| B03002_015 | Hispanic or Latino, American Indian and Alaska Native alone | HoLAIAN |
| B03002_016 | Hispanic or Latino, Asian alone | HoLA |
| B03002_017 | Hispanic or Latino, Native Hawaiian and other Pacific Islander alone | HoLNHOPI |
| B03002_018 | Hispanic or Latino, some other race alone | HoLSOR |
| B03002_019 | Hispanic or Latino, two or more races | HoLTOMR |
| B03002_020 | Hispanic or Latino, two races including some other race | HoLTRiSOR |
| B03002_021 | Hispanic or Latino, two races excluding some other race, and three or more races | HoLTReSOR |

A census geography (and its neighbors) that has nearly all of its population who identify with the specified race or ethnicity subgroup(s) (e.g., Not Hispanic or Latino, Black or African American alone) will have an *RI* value close to 1. In contrast, a census geography (and its neighbors) that is nearly none of its population who identify with the specified race or ethnicity subgroup(s) (e.g., not Not Hispanic or Latino, Black or African American alone) will have an *RI* value close to 0.

```{r anthopolos_prep, results = 'hide'}
anthopolos2010NC <- anthopolos(state = 'NC', year = 2010, subgroup = 'NHoLB')

# Obtain the 2010 census tracts from the 'tigris' package
tract2010NC <- tracts(state = 'NC', year = 2010, cb = TRUE)
# Remove first 9 characters from GEOID for compatibility with tigris information
tract2010NC$GEOID <- substring(tract2010NC$GEO_ID, 10) 

# Obtain the 2010 counties from the 'tigris' package
county2010NC <- counties(state = 'NC', year = 2010, cb = TRUE)

# Join the RI values to the census tract geometry
NC2010anthopolos <- tract2010NC %>%
  left_join(anthopolos2010NC$ri, by = 'GEOID')
```

```{r anthopolos_plot, fig.height = 4, fig.width = 7}
# Visualize the RI values (2006-2010 5-year ACS) for North Carolina, U.S.A., census tracts 
ggplot() +
  geom_sf(
    data = NC2010anthopolos,
    aes(fill = RI),
    size = 0.05,
    color = 'transparent'
  ) +
  geom_sf(
    data = county2010NC,
    fill = 'transparent',
    color = 'white',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_viridis_c() +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2006-2010 estimates') +
  ggtitle(
    'Racial Isolation Index (Anthopolos), non-Hispanic Black',
    subtitle = 'NC census tracts (not corrected for edge effects)'
  )
```

The current version of the [*ndi*](https://CRAN.R-project.org/package=ndi) package does not correct for edge effects (e.g., census geographies along the specified spatial extent border, coastline, or U.S.-Mexico / U.S.-Canada border) may have few neighboring census geographies, and *RI* values in these census geographies may be unstable. A stop-gap solution for the former source of edge effect is to compute the *RI* for neighboring census geographies (i.e., the states bordering a study area of interest) and then use the estimates of the study area of interest.

```{r anthopolos_edge_prep, results = 'hide'}
# Compute RI for all census tracts in neighboring states
anthopolos2010GNSTV <- anthopolos(
  state = c('GA', 'NC', 'SC', 'TN', 'VA'),
  year = 2010,
  subgroup = 'NHoLB'
)

# Crop to only North Carolina, U.S.A. census tracts
anthopolos2010NCe <- anthopolos2010GNSTV$ri[anthopolos2010GNSTV$ri$GEOID %in% 
                                              anthopolos2010NC$ri$GEOID, ]

# Obtain the 2010 census tracts from the 'tigris' package
tract2010NC <- tracts(state = 'NC', year = 2010, cb = TRUE)
# Remove first 9 characters from GEOID for compatibility with tigris information
tract2010NC$GEOID <- substring(tract2010NC$GEO_ID, 10) 

# Obtain the 2010 counties from the 'tigris' package
county2010NC <- counties(state = 'NC', year = 2010, cb = TRUE)

# Join the RI values to the census tract geometry
edgeNC2010anthopolos <- tract2010NC %>% 
  left_join(anthopolos2010NCe, by = 'GEOID')
```

```{r anthopolos_edge_plot, fig.height = 4, fig.width = 7}
# Visualize the RI values (2006-2010 5-year ACS) for North Carolina, U.S.A., census tracts 
ggplot() +
  geom_sf(
    data = edgeNC2010anthopolos,
    aes(fill = RI),
    size = 0.05,
    color = 'transparent'
  ) +
  geom_sf(
    data = county2010NC,
    fill = 'transparent',
    color = 'white',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_viridis_c() +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2006-2010 estimates') +
  ggtitle(
    'Racial Isolation Index (Anthopolos), non-Hispanic Black',
    subtitle = 'NC census tracts (corrected for interstate edge effects)'
  )
```

#### Compute Educational Isolation Index (*EI*)

Compute the spatial *EI* (Bravo) values (2006-2010 5-year ACS) for Oklahoma, U.S.A., census tracts. This metric is based on [Bravo et al. (2021)](https://doi.org/10.3390/ijerph18179384) that assessed the educational isolation of the population without a four-year college degree. Multiple educational attainment categories are available in the `bravo()` function, including:

| ACS table source | educational attainment category | character for `subgroup` argument |
| -------------- | ------------- | ---------------- |
| B06009_002 | less than high school graduate | LtHS |
| B06009_003 | high school graduate (includes equivalency) | HSGiE |
| B06009_004 | some college or associate's degree | SCoAD |
| B06009_005 | Bachelor's degree | BD |
| B06009_006 | graduate or professional degree | GoPD |
Note: The ACS-5 data (2005-2009) uses the 'B15002' question.

A census geography (and its neighbors) that has nearly all of its population with the specified educational attainment category (e.g., a four-year college degree or more) will have an *EI* (Bravo) value close to 1. In contrast, a census geography (and its neighbors) that is nearly none of its population with the specified educational attainment category (e.g., with a four-year college degree) will have an *EI* (Bravo) value close to 0.

```{r bravo_prep, results = 'hide'}
bravo2010OK <- bravo(state = 'OK', year = 2010, subgroup = c('LtHS', 'HSGiE', 'SCoAD'))

# Obtain the 2010 census tracts from the 'tigris' package
tract2010OK <- tracts(state = 'OK', year = 2010, cb = TRUE)
# Remove first 9 characters from GEOID for compatibility with tigris information
tract2010OK$GEOID <- substring(tract2010OK$GEO_ID, 10) 

# Obtain the 2010 counties from the 'tigris' package
county2010OK <- counties(state = 'OK', year = 2010, cb = TRUE)

# Join the EI (Bravo) values to the census tract geometry
OK2010bravo <- tract2010OK %>%
  left_join(bravo2010OK$ei, by = 'GEOID')
```

```{r bravo_plot, fig.height = 4, fig.width = 7}
# Visualize the EI (Bravo) values (2006-2010 5-year ACS) for Oklahoma, U.S.A., census tracts 
ggplot() +
  geom_sf(
    data = OK2010bravo,
    aes(fill = EI),
    size = 0.05,
    color = 'transparent'
  ) +
  geom_sf(
    data = county2010OK,
    fill = 'transparent',
    color = 'white',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_viridis_c(limits = c(0, 1)) +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2006-2010 estimates') +
  ggtitle(
    'Educational Isolation Index (Bravo), without a four-year college degree',
    subtitle = 'OK census tracts (not corrected for edge effects)'
  )
```

Can correct one source of edge effect in the same manner as shown for the *RI* metric.

#### The racial or ethnic Gini Index (*G*)

Compute the racial or ethnic Gini Index (*G*) values (2006-2010 5-year ACS) for Massachusetts, U.S.A., census tracts within counties. This metric is based on [Gini (1921)](https://doi.org/10.2307/2223319). Multiple racial or ethnic subgroups are available in the `gini()` function, including:

| ACS table source | racial or ethnic subgroup | character for `subgroup` arguments |
| -------------- | ------------- | ---------------- |
| B03002_002 | not Hispanic or Latino | NHoL |
| B03002_003 | not Hispanic or Latino, white alone | NHoLW |
| B03002_004 | not Hispanic or Latino, Black or African American alone | NHoLB |
| B03002_005 | not Hispanic or Latino, American Indian and Alaska Native alone | NHoLAIAN |
| B03002_006 | not Hispanic or Latino, Asian alone | NHoLA |
| B03002_007 | not Hispanic or Latino, Native Hawaiian and Other Pacific Islander alone | NHoLNHOPI |
| B03002_008 | not Hispanic or Latino, some other race alone | NHoLSOR |
| B03002_009 | not Hispanic or Latino, two or more races | NHoLTOMR |
| B03002_010 | not Hispanic or Latino, two races including some other race | NHoLTRiSOR |
| B03002_011 | not Hispanic or Latino, two races excluding some other race, and three or more races | NHoLTReSOR |
| B03002_012 | Hispanic or Latino | HoL |
| B03002_013 | Hispanic or Latino, white alone | HoLW |
| B03002_014 | Hispanic or Latino, Black or African American alone | HoLB |
| B03002_015 | Hispanic or Latino, American Indian and Alaska Native alone | HoLAIAN |
| B03002_016 | Hispanic or Latino, Asian alone | HoLA |
| B03002_017 | Hispanic or Latino, Native Hawaiian and other Pacific Islander alone | HoLNHOPI |
| B03002_018 | Hispanic or Latino, some other race alone | HoLSOR |
| B03002_019 | Hispanic or Latino, two or more races | HoLTOMR |
| B03002_020 | Hispanic or Latino, two races including some other race | HoLTRiSOR |
| B03002_021 | Hispanic or Latino, two races excluding some other race, and three or more races | HoLTReSOR |

*G* is a measure of the evenness of racial or ethnic residential populations when comparing smaller geographical areas to larger ones within which the smaller geographical areas are located. *G* can range in value from 0 to 1 and the mean absolute difference between a selected subgroup proportions weighted across all pairs of geographic units, expressed as a proportion of the maximum weighted difference.

```{r g_re_prep, results = 'hide'}
gini2010MA <- gini(
  geo_large = 'county',
  geo_small = 'tract',
  state = 'MA',
  year = 2010,
  subgroup = c('NHoLB', 'HoLB')
)

# Obtain the 2010 census tracts from the 'tigris' package
county2010MA <- counties(state = 'MA', year = 2010, cb = TRUE)
# Remove first 9 characters from GEOID for compatibility with tigris information
county2010MA$GEOID <- substring(county2010MA$GEO_ID, 10) 

# Join the G (Gini) values to the census tract geometry
MA2010gini <- county2010MA %>%
  left_join(gini2010MA$g, by = 'GEOID')
```

```{r g_re_plot, fig.height = 4, fig.width = 7}
# Visualize the G (Gini) values (2006-2010 5-year ACS) for Massachusetts, U.S.A., census tracts 
ggplot() +
  geom_sf(
    data = MA2010gini,
    aes(fill = G_re),
    size = 0.05,
    color = 'transparent'
  ) +
  geom_sf(
    data = county2010MA,
    fill = 'transparent',
    color = 'white',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_viridis_c(limits = c(0, 1)) +
  labs(
    fill = 'Index (Continuous)',
    caption = 'Source: U.S. Census ACS 2006-2010 estimates') +
  ggtitle('Gini Index', subtitle = 'Black population of MA counties')
```

#### The income Gini Index (*G*)

Retrieve the income Gini Index (*G*) values (2006-2010 5-year ACS) for Massachusetts, U.S.A., census tracts. This metric is based on [Gini (1921)](https://doi.org/10.2307/2223319), and the `gini()` function retrieves the estimate from the ACS-5 when calculating the Gini Index (*G*) for racial or ethnic inequality.

According to the [U.S. Census Bureau](https://census.gov/topics/income-poverty/income-inequality/about/metrics/gini-index.html): 'The Gini Index is a summary measure of income inequality. The Gini coefficient incorporates the detailed shares data into a single statistic, which summarizes the dispersion of income across the entire income distribution. The Gini coefficient ranges from 0, indicating perfect equality (where everyone receives an equal share), to 1, perfect inequality (where only one recipient or group of recipients receives all the income). The Gini Index is based on the difference between the Lorenz curve (the observed cumulative income distribution) and the notion of a perfectly equal income distribution.'

```{r gini_prep, results = 'hide'}
gini2010MA <- gini(
  geo_large = 'county',
  geo_small = 'tract',
  state = 'MA',
  year = 2010,
  subgroup = c('NHoLB', 'HoLB')
)

# Obtain the 2010 census tracts from the 'tigris' package
tract2010MA <- tracts(state = 'MA', year = 2010, cb = TRUE)
# Remove first 9 characters from GEOID for compatibility with tigris information
tract2010MA$GEOID <- substring(tract2010MA$GEO_ID, 10) 

# Obtain the 2010 counties from the 'tigris' package
county2010MA <- counties(state = 'MA', year = 2010, cb = TRUE)

# Join the G (Gini) values to the census tract geometry
MA2010gini <- tract2010MA %>%
  left_join(gini2010MA$g_data, by = 'GEOID')
```

```{r gini_plot, fig.height = 4, fig.width = 7}
# Visualize the G (Gini) values (2006-2010 5-year ACS) for Massachusetts, U.S.A., census tracts 
ggplot() +
  geom_sf(
    data = MA2010gini,
    aes(fill = G_inc),
    size = 0.05,
    color = 'transparent'
  ) +
  geom_sf(
    data = county2010MA,
    fill = 'transparent',
    color = 'white',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_viridis_c(limits = c(0, 1)) +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2006-2010 estimates') +
  ggtitle('Gini Index', subtitle = 'Income of MA census tracts')
```


### Index of Concentration at the Extremes (*ICE*)

Compute the Index of Concentration at the Extremes values (2006-2010 5-year ACS) for Wayne County, Michigan, U.S.A., census tracts. Wayne County is the home of Detroit, Michigan, a highly segregated city in the U.S. This metric is based on [Feldman et al. (2015)](https://doi.org/10.1136/jech-2015-205728) and [Krieger et al. (2016)](https://doi.org/10.2105/AJPH.2015.302955) who expanded the metric designed by Massey in a chapter of [Booth & Crouter (2001)](https://doi.org/10.4324/9781410600141) initially designed for residential segregation. The `krieger()` function computes five *ICE* metrics using the following ACS-5 groups:

| ACS table group | *ICE* metric | Comparison |
| -------------- | ------------- | ---------------- |
| B19001 | Income, 'ICE_inc'| 80th income percentile vs. 20th income percentile |
| B15002 | Education, 'ICE_edu'| less than high school vs. four-year college degree or more |
| B03002 | Race or Ethnicity, 'ICE_rewb'| 80th income percentile vs. 20th income percentile |
| B19001 & B19001B & B19001H | Income and race or ethnicity combined, 'ICE_wbinc' | white non-Hispanic in 80th income percentile vs. black alone (including Hispanic) in 20th income percentile |
| B19001 & B19001H | Income and race or ethnicity combined, 'ICE_wpcinc'| white non-Hispanic in 80th income percentile vs. white non-Hispanic in 20th income percentile |

*ICE* metrics can range in value from âˆ’1 (most deprived) to 1 (most privileged). A value of 0 can thus represent two possibilities: (1) none of the residents are in the most privileged or most deprived categories, or (2) an equal number of persons are in the most privileged and most deprived categories, and in both cases indicates that the area is not dominated by extreme concentrations of either of the two groups.

```{r krieger_prep, results = 'hide'}
ice2020WC <- krieger(state = 'MI', county = 'Wayne', year = 2010)

# Obtain the 2010 census tracts from the 'tigris' package
tract2010WC <- tracts(state = 'MI', county = 'Wayne', year = 2010, cb = TRUE)
# Remove first 9 characters from GEOID for compatibility with tigris information
tract2010WC$GEOID <- substring(tract2010WC$GEO_ID, 10) 

# Join the ICE values to the census tract geometry
ice2020WC <- tract2010WC %>%
  left_join(ice2020WC$ice, by = 'GEOID')
```

```{r krieger_plot, fig.height = 5.5, fig.width = 7}
# Plot ICE for Income
ggplot() +
  geom_sf(
    data = ice2020WC,
    aes(fill = ICE_inc),
    color = 'white',
    size = 0.05
  ) +
  theme_bw() +
  scale_fill_gradient2(
    low = '#998ec3',
    mid = '#f7f7f7',
    high = '#f1a340',
    limits = c(-1, 1)
  ) +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2006-2010 estimates') +
  ggtitle(
    'Index of Concentration at the Extremes\nIncome (Krieger)',
    subtitle = '80th income percentile vs. 20th income percentile'
  )

# Plot ICE for Education
ggplot() +
  geom_sf(
    data = ice2020WC,
    aes(fill = ICE_edu),
    color = 'white',
    size = 0.05
  ) +
  theme_bw() +
  scale_fill_gradient2(
    low = '#998ec3',
    mid = '#f7f7f7',
    high = '#f1a340',
    limits = c(-1, 1)
  ) +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2006-2010 estimates') +
  ggtitle(
    'Index of Concentration at the Extremes\nEducation (Krieger)',
    subtitle = 'less than high school vs. four-year college degree or more'
  )

# Plot ICE for Race or Ethnicity
ggplot() +
  geom_sf(
    data = ice2020WC,
    aes(fill = ICE_rewb),
    color = 'white',
    size = 0.05
  ) +
  theme_bw() +
  scale_fill_gradient2(
    low = '#998ec3',
    mid = '#f7f7f7',
    high = '#f1a340',
    limits = c(-1, 1)
  ) +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2006-2010 estimates') +
  ggtitle(
    'Index of Concentration at the Extremes\nRace or Ethnicity (Krieger)',
    subtitle = 'white non-Hispanic vs. black non-Hispanic'
  )

# Plot ICE for Income and Race or Ethnicity Combined
## white non-Hispanic in 80th income percentile vs. 
## black (including Hispanic) in 20th income percentile
ggplot() +
  geom_sf(
    data = ice2020WC,
    aes(fill = ICE_wbinc),
    color = 'white',
    size = 0.05
  ) +
  theme_bw() +
  scale_fill_gradient2(
    low = '#998ec3',
    mid = '#f7f7f7',
    high = '#f1a340',
    limits = c(-1, 1)
  ) +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2006-2010 estimates') +
  ggtitle(
    'Index of Concentration at the Extremes\nIncome & race or ethnicity combined (Krieger)',
    subtitle = 'white non-Hispanic in 80th inc ptcl vs. black alone in 20th inc pctl'
  )

# Plot ICE for Income and Race or Ethnicity Combined
## white non-Hispanic in 80th income percentile vs. white non-Hispanic in 20th income percentile
ggplot() +
  geom_sf(
    data = ice2020WC,
    aes(fill = ICE_wpcinc),
    color = 'white',
    size = 0.05
  ) +
  theme_bw() +
  scale_fill_gradient2(
    low = '#998ec3',
    mid = '#f7f7f7',
    high = '#f1a340',
    limits = c(-1, 1)
  ) +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2006-2010 estimates') +
  ggtitle(
    'Index of Concentration at the Extremes\nIncome & race or ethnicity combined (Krieger)',
    subtitle = 'white non-Hispanic (WNH) in 80th inc pctl vs. WNH in 20th inc pctl'
  )
```

#### Compute racial or ethnic Dissimilarity Index (*D*)

Compute the racial or ethnic *D* values (2006-2010 5-year ACS) for Pennsylvania, U.S.A., counties from census tracts. This metric is based on [Duncan & Duncan (1955)](https://doi.org/10.2307/2088328) that assessed the racial or ethnic isolation of students that identify as non-Hispanic or Latino, Black or African American alone compared to students that identify as non-Hispanic or Latino, white alone between schools and school districts. Multiple racial or ethnic subgroups are available in the `duncan()` function, including:

| ACS table source | racial or ethnic subgroup | character for `subgroup` or `subgroup_ref` arguments |
| -------------- | ------------- | ---------------- |
| B03002_002 | not Hispanic or Latino | NHoL |
| B03002_003 | not Hispanic or Latino, white alone | NHoLW |
| B03002_004 | not Hispanic or Latino, Black or African American alone | NHoLB |
| B03002_005 | not Hispanic or Latino, American Indian and Alaska Native alone | NHoLAIAN |
| B03002_006 | not Hispanic or Latino, Asian alone | NHoLA |
| B03002_007 | not Hispanic or Latino, Native Hawaiian and Other Pacific Islander alone | NHoLNHOPI |
| B03002_008 | not Hispanic or Latino, some other race alone | NHoLSOR |
| B03002_009 | not Hispanic or Latino, two or more races | NHoLTOMR |
| B03002_010 | not Hispanic or Latino, two races including some other race | NHoLTRiSOR |
| B03002_011 | not Hispanic or Latino, two races excluding some other race, and three or more races | NHoLTReSOR |
| B03002_012 | Hispanic or Latino | HoL |
| B03002_013 | Hispanic or Latino, white alone | HoLW |
| B03002_014 | Hispanic or Latino, Black or African American alone | HoLB |
| B03002_015 | Hispanic or Latino, American Indian and Alaska Native alone | HoLAIAN |
| B03002_016 | Hispanic or Latino, Asian alone | HoLA |
| B03002_017 | Hispanic or Latino, Native Hawaiian and other Pacific Islander alone | HoLNHOPI |
| B03002_018 | Hispanic or Latino, some other race alone | HoLSOR |
| B03002_019 | Hispanic or Latino, two or more races | HoLTOMR |
| B03002_020 | Hispanic or Latino, two races including some other race | HoLTRiSOR |
| B03002_021 | Hispanic or Latino, two races excluding some other race, and three or more races | HoLTReSOR |

*D* is a measure of the evenness of racial or ethnic residential segregation when comparing smaller geographical areas to larger ones within which the smaller geographical areas are located. *D* can range in value from 0 to 1 and represents the proportion of racial or ethnic subgroup members that would have to change their area of residence to achieve an even distribution within the larger geographical area under conditions of maximum segregation.

```{r duncan_prep, results = 'hide'}
duncan2010PA <- duncan(
  geo_large = 'county',
  geo_small = 'tract',
  state = 'PA',
  year = 2010,
  subgroup = 'NHoLB',
  subgroup_ref = 'NHoLW'
)

# Obtain the 2010 census counties from the 'tigris' package
county2010PA <- counties(state = 'PA', year = 2010, cb = TRUE)
# Remove first 9 characters from GEOID for compatibility with tigris information
county2010PA$GEOID <- substring(county2010PA$GEO_ID, 10) 

# Join the D values to the county geometry
PA2010duncan <- county2010PA %>%
  left_join(duncan2010PA$d, by = 'GEOID')
```

```{r duncan_plot, fig.height = 4, fig.width = 7}
# Visualize the D values (2006-2010 5-year ACS) for Pennsylvania, U.S.A., counties 
ggplot() +
  geom_sf(
    data = PA2010duncan,
    aes(fill = D),
    size = 0.05,
    color = 'white'
  ) +
  geom_sf(
    data = county2010PA,
    fill = 'transparent',
    color = 'white',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_viridis_c(limits = c(0, 1)) +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2006-2010 estimates') +
  ggtitle(
    'Dissimilarity Index (Duncan & Duncan)\nPennsylvania census tracts to counties',
    subtitle = 'Black non-Hispanic vs. white non-Hispanic'
  )
```

#### Compute income or racial or ethnic Atkinson Index (*A*)

Compute the income or racial or ethnic *A* values (2017-2021 5-year ACS) for Kentucky, U.S.A., counties from census block groups. This metric is based on [Atkinson (1970)](https://doi.org/10.2307/2088328) that assessed the distribution of income within 12 counties but has since been adapted to study racial or ethnic segregation (see [James & Taeuber 1985](https://doi.org/10.2307/270845)). To compare median household income, specify `subgroup = 'MedHHInc'` which will use the ACS-5 variable 'B19013_001' in the computation. Multiple racial or ethnic subgroups are available in the `atkinson()` function, including:

| ACS table source | racial or ethnic subgroup | character for `subgroup` argument |
| -------------- | ------------- | ---------------- |
| B03002_002 | not Hispanic or Latino | NHoL |
| B03002_003 | not Hispanic or Latino, white alone | NHoLW |
| B03002_004 | not Hispanic or Latino, Black or African American alone | NHoLB |
| B03002_005 | not Hispanic or Latino, American Indian and Alaska Native alone | NHoLAIAN |
| B03002_006 | not Hispanic or Latino, Asian alone | NHoLA |
| B03002_007 | not Hispanic or Latino, Native Hawaiian and Other Pacific Islander alone | NHoLNHOPI |
| B03002_008 | not Hispanic or Latino, some other race alone | NHoLSOR |
| B03002_009 | not Hispanic or Latino, two or more races | NHoLTOMR |
| B03002_010 | not Hispanic or Latino, two races including some other race | NHoLTRiSOR |
| B03002_011 | not Hispanic or Latino, two races excluding some other race, and three or more races | NHoLTReSOR |
| B03002_012 | Hispanic or Latino | HoL |
| B03002_013 | Hispanic or Latino, white alone | HoLW |
| B03002_014 | Hispanic or Latino, Black or African American alone | HoLB |
| B03002_015 | Hispanic or Latino, American Indian and Alaska Native alone | HoLAIAN |
| B03002_016 | Hispanic or Latino, Asian alone | HoLA |
| B03002_017 | Hispanic or Latino, Native Hawaiian and other Pacific Islander alone | HoLNHOPI |
| B03002_018 | Hispanic or Latino, some other race alone | HoLSOR |
| B03002_019 | Hispanic or Latino, two or more races | HoLTOMR |
| B03002_020 | Hispanic or Latino, two races including some other race | HoLTRiSOR |
| B03002_021 | Hispanic or Latino, two races excluding some other race, and three or more races | HoLTReSOR |

*A* is a measure of the inequality and, in the context of residential race or ethnicity, segregation when comparing smaller geographical areas to larger ones within which the smaller geographical areas are located. *A* can range in value from 0 to 1 and smaller values of the index indicate lower levels of inequality (e.g., less segregation).

*A* is sensitive to the choice of `epsilon` argument or the shape parameter that determines how to weight the increments to inequality (segregation) contributed by different proportions of the Lorenz curve. A user must explicitly decide how heavily to weight smaller geographical units at different points on the Lorenz curve (i.e., whether the index should take greater account of differences among areas of over- or under-representation). The `epsilon` argument must have values between 0 and 1.0. For `0 <= epsilon < 0.5` or less 'inequality-averse,' smaller geographical units with a subgroup proportion smaller than the subgroup proportion of the larger geographical unit contribute more to inequality ('over-representation'). For `0.5 < epsilon <= 1.0` or more 'inequality-averse,' smaller geographical units with a subgroup proportion larger than the subgroup proportion of the larger geographical unit contribute more to inequality ('under-representation'). If `epsilon = 0.5` (the default), units of over- and under-representation contribute equally to the index. See Section 2.3 of [Saint-Jacques et al. (2020)](https://doi.org/10.48550/arXiv.2002.05819) for one method to select `epsilon`. We choose `epsilon = 0.67` in the example below:

```{r atkinson_prep, results = 'hide'}
atkinson2021KY <- atkinson(
  geo_large = 'county',
  geo_small = 'block group',
  state = 'KY',
  year = 2021,
  subgroup = 'NHoLB',
  epsilon = 0.67
)

# Obtain the 2021 census counties from the 'tigris' package
county2021KY <- counties(state = 'KY', year = 2021, cb = TRUE)

# Join the A values to the county geometry
KY2021atkinson <- county2021KY %>% 
  left_join(atkinson2021KY$a, by = 'GEOID')
```

```{r atkinson_plot, fig.height = 4, fig.width = 7}
# Visualize the A values (2017-2021 5-year ACS) for Kentucky, U.S.A., counties
ggplot() +
  geom_sf(
    data = KY2021atkinson,
    aes(fill = A),
    size = 0.05,
    color = 'white'
  ) +
  geom_sf(
    data = county2021KY,
    fill = 'transparent',
    color = 'white',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_viridis_c(limits = c(0, 1)) +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2017-2021 estimates') +
  ggtitle(
    'Atkinson Index (Atkinson)\nKentucky census block groups to counties',
    subtitle = expression(paste('Black non-Hispanic (', epsilon, ' = 0.67)'))
  )
```

#### Compute racial or ethnic Interaction Index (_xPy\*_)

Compute the racial or ethnic _xPy\*_ values (2017-2021 5-year ACS) for Ohio, U.S.A., counties from census tracts. This metric is based on Shevky & Williams (1949; ISBN-13:978-0-837-15637-8) and adapted by [Bell (1954)](https://doi.org/10.2307/2574118). Multiple racial or ethnic subgroups are available in the `bell()` function, including:

| ACS table source | racial or ethnic subgroup | character for `subgroup` or `subgroup_ixn` argument |
| -------------- | ------------- | ---------------- |
| B03002_002 | not Hispanic or Latino | NHoL |
| B03002_003 | not Hispanic or Latino, white alone | NHoLW |
| B03002_004 | not Hispanic or Latino, Black or African American alone | NHoLB |
| B03002_005 | not Hispanic or Latino, American Indian and Alaska Native alone | NHoLAIAN |
| B03002_006 | not Hispanic or Latino, Asian alone | NHoLA |
| B03002_007 | not Hispanic or Latino, Native Hawaiian and Other Pacific Islander alone | NHoLNHOPI |
| B03002_008 | not Hispanic or Latino, some other race alone | NHoLSOR |
| B03002_009 | not Hispanic or Latino, two or more races | NHoLTOMR |
| B03002_010 | not Hispanic or Latino, two races including some other race | NHoLTRiSOR |
| B03002_011 | not Hispanic or Latino, two races excluding some other race, and three or more races | NHoLTReSOR |
| B03002_012 | Hispanic or Latino | HoL |
| B03002_013 | Hispanic or Latino, white alone | HoLW |
| B03002_014 | Hispanic or Latino, Black or African American alone | HoLB |
| B03002_015 | Hispanic or Latino, American Indian and Alaska Native alone | HoLAIAN |
| B03002_016 | Hispanic or Latino, Asian alone | HoLA |
| B03002_017 | Hispanic or Latino, Native Hawaiian and other Pacific Islander alone | HoLNHOPI |
| B03002_018 | Hispanic or Latino, some other race alone | HoLSOR |
| B03002_019 | Hispanic or Latino, two or more races | HoLTOMR |
| B03002_020 | Hispanic or Latino, two races including some other race | HoLTRiSOR |
| B03002_021 | Hispanic or Latino, two races excluding some other race, and three or more races | HoLTReSOR |

_xPy\*_ is some measure of the probability that a member of one subgroup(s) will meet or interact with a member of another subgroup(s) with higher values signifying higher probability of interaction (less isolation) when comparing smaller geographical areas to larger ones within which the smaller geographical areas are located. _xPy\*_ can range in value from 0 to 1.

```{r bell_prep, results = 'hide'}
bell2021OH <- bell(
  geo_large = 'county',
  geo_small = 'tract',
  state = 'OH',
  year = 2021,
  subgroup = 'NHoLB',
  subgroup_ixn = 'NHoLW'
)

# Obtain the 2021 census counties from the 'tigris' package
county2021OH <- counties(state = 'OH', year = 2021, cb = TRUE)

# Join the xPy* values to the county geometry
OH2021bell <- county2021OH %>%
  left_join(bell2021OH$xpy_star, by = 'GEOID')
```

```{r bell_plot, fig.height = 6, fig.width = 7}
# Visualize the xPy* values (2017-2021 5-year ACS) for Ohio, U.S.A., counties
ggplot() +
  geom_sf(
    data = OH2021bell,
    aes(fill = xPy_star),
    size = 0.05,
    color = 'white'
  ) +
  geom_sf(
    data = county2021OH,
    fill = 'transparent',
    color = 'white',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_viridis_c(limits = c(0, 1)) +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2017-2021 estimates') +
  ggtitle(
    'Interaction Index (Bell)\nOhio census tracts to counties',
    subtitle = 'Black non-Hispanic vs. white non-Hispanic'
  )
```

#### Compute Correlation Ratio (*V*)

Compute the racial or ethnic *V* values (2017-2021 5-year ACS) for South Carolina, U.S.A., counties from census tracts. This metric is based on [Bell (1954)](https://doi.org/10.2307/2574118) and adapted by [White (1986)](https://doi.org/10.2307/3644339). Multiple racial or ethnic subgroups are available in the `white()` function, including:

| ACS table source | racial or ethnic subgroup | character for `subgroup` argument |
| -------------- | ------------- | ---------------- |
| B03002_002 | not Hispanic or Latino | NHoL |
| B03002_003 | not Hispanic or Latino, white alone | NHoLW |
| B03002_004 | not Hispanic or Latino, Black or African American alone | NHoLB |
| B03002_005 | not Hispanic or Latino, American Indian and Alaska Native alone | NHoLAIAN |
| B03002_006 | not Hispanic or Latino, Asian alone | NHoLA |
| B03002_007 | not Hispanic or Latino, Native Hawaiian and Other Pacific Islander alone | NHoLNHOPI |
| B03002_008 | not Hispanic or Latino, some other race alone | NHoLSOR |
| B03002_009 | not Hispanic or Latino, two or more races | NHoLTOMR |
| B03002_010 | not Hispanic or Latino, two races including some other race | NHoLTRiSOR |
| B03002_011 | not Hispanic or Latino, two races excluding some other race, and three or more races | NHoLTReSOR |
| B03002_012 | Hispanic or Latino | HoL |
| B03002_013 | Hispanic or Latino, white alone | HoLW |
| B03002_014 | Hispanic or Latino, Black or African American alone | HoLB |
| B03002_015 | Hispanic or Latino, American Indian and Alaska Native alone | HoLAIAN |
| B03002_016 | Hispanic or Latino, Asian alone | HoLA |
| B03002_017 | Hispanic or Latino, Native Hawaiian and other Pacific Islander alone | HoLNHOPI |
| B03002_018 | Hispanic or Latino, some other race alone | HoLSOR |
| B03002_019 | Hispanic or Latino, two or more races | HoLTOMR |
| B03002_020 | Hispanic or Latino, two races including some other race | HoLTRiSOR |
| B03002_021 | Hispanic or Latino, two races excluding some other race, and three or more races | HoLTReSOR |

*V* removes the asymmetry from the Isolation Index by controlling for the effect of population composition when comparing smaller geographical areas to larger ones within which the smaller geographical areas are located. The Isolation Index is some measure of the probability that a member of one subgroup(s) will meet or interact with a member of another subgroup(s) with higher values signifying higher probability of interaction (less isolation). *V* can range in value from 0 to Inf.

```{r white_prep, results = 'hide'}
white2021SC <- white(
  geo_large = 'county',
  geo_small = 'tract',
  state = 'SC',
  year = 2021,
  subgroup = 'NHoLB'
)

# Obtain the 2021 census counties from the 'tigris' package
county2021SC <- counties(state = 'SC', year = 2021, cb = TRUE)

# Join the V values to the county geometry
SC2021white <- county2021SC %>%
  left_join(white2021SC$v, by = 'GEOID')
```

```{r white_plot, fig.height = 6, fig.width = 7}
# Visualize the V values (2017-2021 5-year ACS) for South Carolina, U.S.A., counties
ggplot() +
  geom_sf(
    data = SC2021white,
    aes(fill = V),
    size = 0.05,
    color = 'white'
  ) +
  geom_sf(
    data = county2021SC,
    fill = 'transparent',
    color = 'white',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_gradient2(
    low = '#998ec3', 
    mid = '#f7f7f7', 
    high = '#f1a340', 
    midpoint = 1
  ) +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2017-2021 estimates') +
  ggtitle(
    'Correlation Ratio (White)\nSouth Carolina census tracts to counties',
    subtitle = 'Black non-Hispanic'
  )
```

#### Compute Location Quotient (*LQ*)

Compute the racial or ethnic *LQ* values (2017-2021 5-year ACS) for Tennessee, U.S.A., counties vs. the state. This metric is based on [Merton (1939)](https://doi.org/10.2307/2084686) and adapted by [Sudano et al. (2013)](https://doi.org/10.1016/j.healthplace.2012.09.015). Multiple racial or ethnic subgroups are available in the `sudano()` function, including:

| ACS table source | racial or ethnic subgroup | character for `subgroup` argument |
| -------------- | ------------- | ---------------- |
| B03002_002 | not Hispanic or Latino | NHoL |
| B03002_003 | not Hispanic or Latino, white alone | NHoLW |
| B03002_004 | not Hispanic or Latino, Black or African American alone | NHoLB |
| B03002_005 | not Hispanic or Latino, American Indian and Alaska Native alone | NHoLAIAN |
| B03002_006 | not Hispanic or Latino, Asian alone | NHoLA |
| B03002_007 | not Hispanic or Latino, Native Hawaiian and Other Pacific Islander alone | NHoLNHOPI |
| B03002_008 | not Hispanic or Latino, some other race alone | NHoLSOR |
| B03002_009 | not Hispanic or Latino, two or more races | NHoLTOMR |
| B03002_010 | not Hispanic or Latino, two races including some other race | NHoLTRiSOR |
| B03002_011 | not Hispanic or Latino, two races excluding some other race, and three or more races | NHoLTReSOR |
| B03002_012 | Hispanic or Latino | HoL |
| B03002_013 | Hispanic or Latino, white alone | HoLW |
| B03002_014 | Hispanic or Latino, Black or African American alone | HoLB |
| B03002_015 | Hispanic or Latino, American Indian and Alaska Native alone | HoLAIAN |
| B03002_016 | Hispanic or Latino, Asian alone | HoLA |
| B03002_017 | Hispanic or Latino, Native Hawaiian and other Pacific Islander alone | HoLNHOPI |
| B03002_018 | Hispanic or Latino, some other race alone | HoLSOR |
| B03002_019 | Hispanic or Latino, two or more races | HoLTOMR |
| B03002_020 | Hispanic or Latino, two races including some other race | HoLTRiSOR |
| B03002_021 | Hispanic or Latino, two races excluding some other race, and three or more races | HoLTReSOR |

*LQ* is some measure of relative racial homogeneity of each smaller geography within a larger geography. *LQ* can range in value from 0 to infinity because it is ratio of two proportions in which the numerator is the proportion of subgroup population in a smaller geography and the denominator is the proportion of subgroup population in its larger geography. For example, a smaller geography with an *LQ* of 5 means that the proportion of the subgroup population living in the smaller geography is five times the proportion of the subgroup population in its larger geography. Unlike the previous metrics that aggregate to the larger geography, *LQ* computes values for each smaller geography relative to the larger geography.

```{r sudano_prep, results = 'hide'}
sudano2021TN <- sudano(
  geo_large = 'state',
  geo_small = 'county',
  state = 'TN',
  year = 2021,
  subgroup = 'NHoLB'
)

# Obtain the 2021 census counties from the 'tigris' package
county2021TN <- counties(state = 'TN', year = 2021, cb = TRUE)

# Join the LQ values to the county geometry
TN2021sudano <- county2021TN %>% 
                   left_join(sudano2021TN$lq, by = 'GEOID')
```

```{r sudano_plot, fig.height = 3, fig.width = 7}
# Visualize the LQ values (2017-2021 5-year ACS) for Tennessee, U.S.A., counties
ggplot() +
  geom_sf(
    data = TN2021sudano,
    aes(fill = LQ),
    size = 0.05,
    color = 'white'
  ) +
  geom_sf(
    data = county2021TN,
    fill = 'transparent',
    color = 'white',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_viridis_c() +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2017-2021 estimates') +
  ggtitle(
    'Location Quotient (Sudano)\nTennessee counties vs. state',
    subtitle = 'Black non-Hispanic'
  )
```

#### Compute Local Exposure and Isolation (*LEx/Is*)

Compute the racial or ethnic Local Exposure and Isolation metric (2017-2021 5-year ACS) for Mississippi, U.S.A., counties vs. the state. This metric is based on [Bemanian & Beyer (2017)](https://doi.org/10.1158/1055-9965.EPI-16-0926). Multiple racial or ethnic subgroups are available in the `bemanian_beyer()` function, including:

| ACS table source | racial or ethnic subgroup | character for `subgroup` or `subgroup_ixn` argument |
| -------------- | ------------- | ---------------- |
| B03002_002 | not Hispanic or Latino | NHoL |
| B03002_003 | not Hispanic or Latino, white alone | NHoLW |
| B03002_004 | not Hispanic or Latino, Black or African American alone | NHoLB |
| B03002_005 | not Hispanic or Latino, American Indian and Alaska Native alone | NHoLAIAN |
| B03002_006 | not Hispanic or Latino, Asian alone | NHoLA |
| B03002_007 | not Hispanic or Latino, Native Hawaiian and Other Pacific Islander alone | NHoLNHOPI |
| B03002_008 | not Hispanic or Latino, some other race alone | NHoLSOR |
| B03002_009 | not Hispanic or Latino, two or more races | NHoLTOMR |
| B03002_010 | not Hispanic or Latino, two races including some other race | NHoLTRiSOR |
| B03002_011 | not Hispanic or Latino, two races excluding some other race, and three or more races | NHoLTReSOR |
| B03002_012 | Hispanic or Latino | HoL |
| B03002_013 | Hispanic or Latino, white alone | HoLW |
| B03002_014 | Hispanic or Latino, Black or African American alone | HoLB |
| B03002_015 | Hispanic or Latino, American Indian and Alaska Native alone | HoLAIAN |
| B03002_016 | Hispanic or Latino, Asian alone | HoLA |
| B03002_017 | Hispanic or Latino, Native Hawaiian and other Pacific Islander alone | HoLNHOPI |
| B03002_018 | Hispanic or Latino, some other race alone | HoLSOR |
| B03002_019 | Hispanic or Latino, two or more races | HoLTOMR |
| B03002_020 | Hispanic or Latino, two races including some other race | HoLTRiSOR |
| B03002_021 | Hispanic or Latino, two races excluding some other race, and three or more races | HoLTReSOR |

*LEx/Is* is a measure of the probability that two individuals living within a specific smaller geography (e.g., census tract) of either different (i.e., exposure) or the same (i.e., isolation) racial or ethnic subgroup(s) will interact, assuming that individuals within a smaller geography are randomly mixed. *LEx/Is* is standardized with a logit transformation and centered against an expected case that all races or ethnicities are evenly distributed across a larger geography. *LEx/Is* can range from negative infinity to infinity. If *LEx/Is* is zero then the estimated probability of the interaction between two people of the given subgroup(s) within a smaller geography is equal to the expected probability if the subgroup(s) were perfectly mixed in the larger geography. If *LEx/Is* is greater than zero then the interaction is more likely to occur within the smaller geography than in the larger geography, and if *LEx/Is* is less than zero then the interaction is less likely to occur within the smaller geography than in the larger geography. Note: the exponentiation of each *LEx/Is* metric results in the odds ratio of the specific exposure or isolation of interest in a smaller geography relative to the larger geography. Similar to *LQ* (Sudano), *LEx/Is* computes values for each smaller geography relative to the larger geography.

```{r bemanian_beyer_prep, results = 'hide'}
bemanian_beyer2021MS <- bemanian_beyer(
  geo_large = 'state',
  geo_small = 'county',
  state = 'MS',
  year = 2021,
  subgroup = 'NHoLB',
  subgroup_ixn = 'NHoLW'
)

# Obtain the 2021 census counties from the 'tigris' package
county2021MS <- counties(state = 'MS', year = 2021, cb = TRUE)

# Join the LEx/Is values to the county geometry
MS2021bemanian_beyer <- county2021MS %>%
  left_join(bemanian_beyer2021MS$lexis, by = 'GEOID')
```

```{r bemanian_beyer_plot, fig.height = 7, fig.width = 6.5}
# Visualize the LEx/Is values (2017-2021 5-year ACS) for Mississippi, U.S.A., counties
ggplot() +
  geom_sf(
    data = MS2021bemanian_beyer,
    aes(fill = LExIs),
    size = 0.05,
    color = 'white'
  ) +
  geom_sf(
    data = county2021MS,
    fill = 'transparent',
    color = 'white',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_gradient2(
    low = '#998ec3',
    mid = '#f7f7f7',
    high = '#f1a340'
  ) +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2017-2021 estimates') +
  ggtitle(
    'Local Exposure and Isolation (Bemanian & Beyer)\nMississippi counties vs. state',
    subtitle = 'Black non-Hispanic vs. White non-Hispanic'
  )
```
```{r bemanian_beyer_odds, fig.height = 7, fig.width = 6.5}
# Visualize the exponentiated LEx/Is values (2017-2021 5-year ACS) for 
## Mississippi, U.S.A., counties
ggplot() +
  geom_sf(
    data = MS2021bemanian_beyer,
    aes(fill = exp(LExIs)),
    size = 0.05,
    color = 'white'
  ) +
  geom_sf(
    data = county2021MS,
    fill = 'transparent',
    color = 'white',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_viridis_c() +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2017-2021 estimates') +
  ggtitle(
    'Odds ratio of Local Exposure and Isolation (Bemanian & Beyer)\n
    Mississippi counties vs. state',
    subtitle = 'Black non-Hispanic vs. White non-Hispanic'
  )
```

#### Compute Delta (*DEL*)

Compute the racial or ethnic *DEL* values (2017-2021 5-year ACS) for Alabama, U.S.A., counties from census tracts. This metric is based on [Hoover (1941)](https://doi.org/10.1017/S0022050700052980) and Duncan et al. (1961; LC:60007089). Multiple racial or ethnic subgroups are available in the `hoover()` function, including:

| ACS table source | racial or ethnic subgroup | character for `subgroup` argument |
| -------------- | ------------- | ---------------- |
| B03002_002 | not Hispanic or Latino | NHoL |
| B03002_003 | not Hispanic or Latino, white alone | NHoLW |
| B03002_004 | not Hispanic or Latino, Black or African American alone | NHoLB |
| B03002_005 | not Hispanic or Latino, American Indian and Alaska Native alone | NHoLAIAN |
| B03002_006 | not Hispanic or Latino, Asian alone | NHoLA |
| B03002_007 | not Hispanic or Latino, Native Hawaiian and Other Pacific Islander alone | NHoLNHOPI |
| B03002_008 | not Hispanic or Latino, some other race alone | NHoLSOR |
| B03002_009 | not Hispanic or Latino, two or more races | NHoLTOMR |
| B03002_010 | not Hispanic or Latino, two races including some other race | NHoLTRiSOR |
| B03002_011 | not Hispanic or Latino, two races excluding some other race, and three or more races | NHoLTReSOR |
| B03002_012 | Hispanic or Latino | HoL |
| B03002_013 | Hispanic or Latino, white alone | HoLW |
| B03002_014 | Hispanic or Latino, Black or African American alone | HoLB |
| B03002_015 | Hispanic or Latino, American Indian and Alaska Native alone | HoLAIAN |
| B03002_016 | Hispanic or Latino, Asian alone | HoLA |
| B03002_017 | Hispanic or Latino, Native Hawaiian and other Pacific Islander alone | HoLNHOPI |
| B03002_018 | Hispanic or Latino, some other race alone | HoLSOR |
| B03002_019 | Hispanic or Latino, two or more races | HoLTOMR |
| B03002_020 | Hispanic or Latino, two races including some other race | HoLTRiSOR |
| B03002_021 | Hispanic or Latino, two races excluding some other race, and three or more races | HoLTReSOR |

*DEL* is a measure of the proportion of members of one subgroup(s) residing in geographic units with above average density of members of the subgroup(s). The index provides the proportion of a subgroup population that would have to move across geographic units to achieve a uniform density. *DEL* can range in value from 0 to 1.

```{r hoover_prep, results = 'hide'}
hoover2021AL <- hoover(
  geo_large = 'county',
  geo_small = 'tract',
  state = 'AL',
  year = 2021,
  subgroup = 'NHoLB'
)

# Obtain the 2021 census counties from the 'tigris' package
county2021AL <- counties(state = 'AL', year = 2021, cb = TRUE)

# Join the DEL values to the county geometry
AL2021hoover <- county2021AL %>%
  left_join(hoover2021AL$del, by = 'GEOID')
```

```{r hoover_plot, fig.height = 7, fig.width = 6}
# Visualize the DEL values (2017-2021 5-year ACS) for Alabama, U.S.A., counties
ggplot() +
  geom_sf(
    data = AL2021hoover,
    aes(fill = DEL),
    size = 0.05,
    color = 'white'
  ) +
  geom_sf(
    data = county2021AL,
    fill = 'transparent',
    color = 'white',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_viridis_c(limits = c(0, 1)) +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2017-2021 estimates') +
  ggtitle(
    'Delta (Hoover)\nAlabama census tracts to counties',
    subtitle = 'Black non-Hispanic'
  )
```

#### Compute an index of spatial proximity (*SP*)

Compute an index of spatial proximity (2010-2014 5-year ACS) for Atlanta, GA, metropolitan area from census tracts. This metric is based on [White (1986)](https://doi.org/10.2307/3644339) and Blau (1977; ISBN-13:978-0-029-03660-0) that designed the metric to identify racial or ethnic enclaves. Multiple racial or ethnic subgroups are available in the `white_blau()` function, including:

| ACS table source | racial or ethnic subgroup | character for `subgroup` or `subgroup_ref` arguments |
| -------------- | ------------- | ---------------- |
| B03002_002 | not Hispanic or Latino | NHoL |
| B03002_003 | not Hispanic or Latino, white alone | NHoLW |
| B03002_004 | not Hispanic or Latino, Black or African American alone | NHoLB |
| B03002_005 | not Hispanic or Latino, American Indian and Alaska Native alone | NHoLAIAN |
| B03002_006 | not Hispanic or Latino, Asian alone | NHoLA |
| B03002_007 | not Hispanic or Latino, Native Hawaiian and Other Pacific Islander alone | NHoLNHOPI |
| B03002_008 | not Hispanic or Latino, some other race alone | NHoLSOR |
| B03002_009 | not Hispanic or Latino, two or more races | NHoLTOMR |
| B03002_010 | not Hispanic or Latino, two races including some other race | NHoLTRiSOR |
| B03002_011 | not Hispanic or Latino, two races excluding some other race, and three or more races | NHoLTReSOR |
| B03002_012 | Hispanic or Latino | HoL |
| B03002_013 | Hispanic or Latino, white alone | HoLW |
| B03002_014 | Hispanic or Latino, Black or African American alone | HoLB |
| B03002_015 | Hispanic or Latino, American Indian and Alaska Native alone | HoLAIAN |
| B03002_016 | Hispanic or Latino, Asian alone | HoLA |
| B03002_017 | Hispanic or Latino, Native Hawaiian and other Pacific Islander alone | HoLNHOPI |
| B03002_018 | Hispanic or Latino, some other race alone | HoLSOR |
| B03002_019 | Hispanic or Latino, two or more races | HoLTOMR |
| B03002_020 | Hispanic or Latino, two races including some other race | HoLTRiSOR |
| B03002_021 | Hispanic or Latino, two races excluding some other race, and three or more races | HoLTReSOR |

*SP* is a measure of clustering of racial or ethnic populations within smaller geographical areas that are located within larger geographical areas. *SP* can range in value from 0 to Inf and represents the degree to which an area is a racial or ethnic enclave. A value of 1 indicates there is no differential clustering between subgroup and referent group members. A value greater than 1 indicates subgroup members live nearer to one another than to referent subgroup members. A value less than 1 indicates subgroup live nearer to and referent subgroup members than to their own subgroup members.

```{r white_blau_prep, results = 'hide'}
whiteblau2014GA <- white_blau(
  geo_large = 'csa',
  geo_small = 'tract',
  state = c('GA', 'AL', 'TN', 'FL'),
  year = 2014,
  subgroup = 'NHoLB',
  subgroup_ref = 'NHoLW'
)

# Obtain the 2014 Combined Statistical Areas from the 'tigris' package
csa2014 <- combined_statistical_areas(year = 2014, cb = TRUE)
# Obtain the 2014 state from the 'tigris' package
state2014 <- states(cb = TRUE)

# Join the SP values to the CSA geometries and filter for Georgia
GA2010whiteblau <- csa2014 %>%
  left_join(whiteblau2014GA$sp, by = 'GEOID') %>%
  filter(!st_is_empty(.)) %>%
  filter(!is.na(SP)) %>%
  st_filter(state2014 %>% filter(STUSPS == 'GA')) %>%
  st_make_valid()
```

```{r white_blau_plot, fig.height = 7, fig.width = 7}
# Visualize the SP values (2010-2014 5-year ACS) for Georgia, U.S.A., CSAs 
ggplot() +
  geom_sf(
    data = GA2010whiteblau,
    aes(fill = SP),
   # size = 0.05,
   # color = 'white'
  ) +
  geom_sf(
    data = state2014 %>% filter(STUSPS == 'GA'),
    fill = 'transparent',
    color = 'black',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_gradient2(
    low = '#998ec3', 
    mid = '#f7f7f7', 
    high = '#f1a340', 
    midpoint = 1
  ) +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2010-2014 estimates') +
  ggtitle(
    'An index of spatial proximity (White)\nCensus tracts to Combined Statistical Areas in Georgia',
    subtitle = 'Black non-Hispanic vs. white non-Hispanic'
  )
```

#### Compute racial or ethnic Isolation Index (_xPx\*_)

Compute the racial or ethnic _xPx\*_ values (2015-2019 5-year ACS) for Delaware, U.S.A., census tracts from census block groups. This metric is based on [Bell (1954)](https://doi.org/10.2307/2574118) and adapted by Lieberson (1981; ISBN-13:978-1-032-53884-6). Multiple racial or ethnic subgroups are available in the `lieberson()` function, including:

| ACS table source | racial or ethnic subgroup | character for `subgroup` argument |
| -------------- | ------------- | ---------------- |
| B03002_002 | not Hispanic or Latino | NHoL |
| B03002_003 | not Hispanic or Latino, white alone | NHoLW |
| B03002_004 | not Hispanic or Latino, Black or African American alone | NHoLB |
| B03002_005 | not Hispanic or Latino, American Indian and Alaska Native alone | NHoLAIAN |
| B03002_006 | not Hispanic or Latino, Asian alone | NHoLA |
| B03002_007 | not Hispanic or Latino, Native Hawaiian and Other Pacific Islander alone | NHoLNHOPI |
| B03002_008 | not Hispanic or Latino, some other race alone | NHoLSOR |
| B03002_009 | not Hispanic or Latino, two or more races | NHoLTOMR |
| B03002_010 | not Hispanic or Latino, two races including some other race | NHoLTRiSOR |
| B03002_011 | not Hispanic or Latino, two races excluding some other race, and three or more races | NHoLTReSOR |
| B03002_012 | Hispanic or Latino | HoL |
| B03002_013 | Hispanic or Latino, white alone | HoLW |
| B03002_014 | Hispanic or Latino, Black or African American alone | HoLB |
| B03002_015 | Hispanic or Latino, American Indian and Alaska Native alone | HoLAIAN |
| B03002_016 | Hispanic or Latino, Asian alone | HoLA |
| B03002_017 | Hispanic or Latino, Native Hawaiian and other Pacific Islander alone | HoLNHOPI |
| B03002_018 | Hispanic or Latino, some other race alone | HoLSOR |
| B03002_019 | Hispanic or Latino, two or more races | HoLTOMR |
| B03002_020 | Hispanic or Latino, two races including some other race | HoLTRiSOR |
| B03002_021 | Hispanic or Latino, two races excluding some other race, and three or more races | HoLTReSOR |

_xPx\*_ is some measure of the probability that a member of one subgroup(s) will meet or interact with a member of another subgroup(s) with higher values signifying higher probability of interaction (less isolation) when comparing smaller geographical areas to larger ones within which the smaller geographical areas are located. _xPx\*_ can range in value from 0 to 1.

```{r lieberson_prep, results = 'hide'}
lieberson2021DE <- lieberson(
  geo_large = 'tract',
  geo_small = 'block group',
  state = 'DE',
  year = 2019,
  subgroup = 'NHoLB'
)

# Obtain the 2021 census counties from the 'tigris' package
tract2021DE <- tracts(state = 'DE', year = 2019, cb = TRUE)

# Join the xPx* values to the county geometry
DE2021lieberson <- tract2021DE %>%
  left_join(lieberson2021DE$xpx_star, by = 'GEOID')
```

```{r lieberson_plot, fig.height = 9, fig.width = 7}
# Visualize the xPx* values (2015-2019 5-year ACS) for Delaware, U.S.A., census tracts
ggplot() +
  geom_sf(
    data = DE2021lieberson,
    aes(fill = xPx_star),
    size = 0.05,
    color = 'white'
  ) +
  geom_sf(
    data = tract2021DE,
    fill = 'transparent',
    color = 'white',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_viridis_c(limits = c(0, 1)) +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2015-2019 estimates') +
  ggtitle(
    'Isolation Index (Lieberson)\nDelaware census block groups to census tracts',
    subtitle = 'Black non-Hispanic'
  )
```

#### Compute racial or ethnic Dissimilarity Index (*D*)

Compute the racial or ethnic *D* values (2006-2010 5-year ACS) for Pennsylvania, U.S.A., counties from census tracts. This metric is based on [James & Taeuber (1985)](https://doi.org/10.2307/270845). Multiple racial or ethnic subgroups are available in the `james_taeuber()` function, including:

| ACS table source | racial or ethnic subgroup | character for `subgroup`arguments |
| -------------- | ------------- | ---------------- |
| B03002_002 | not Hispanic or Latino | NHoL |
| B03002_003 | not Hispanic or Latino, white alone | NHoLW |
| B03002_004 | not Hispanic or Latino, Black or African American alone | NHoLB |
| B03002_005 | not Hispanic or Latino, American Indian and Alaska Native alone | NHoLAIAN |
| B03002_006 | not Hispanic or Latino, Asian alone | NHoLA |
| B03002_007 | not Hispanic or Latino, Native Hawaiian and Other Pacific Islander alone | NHoLNHOPI |
| B03002_008 | not Hispanic or Latino, some other race alone | NHoLSOR |
| B03002_009 | not Hispanic or Latino, two or more races | NHoLTOMR |
| B03002_010 | not Hispanic or Latino, two races including some other race | NHoLTRiSOR |
| B03002_011 | not Hispanic or Latino, two races excluding some other race, and three or more races | NHoLTReSOR |
| B03002_012 | Hispanic or Latino | HoL |
| B03002_013 | Hispanic or Latino, white alone | HoLW |
| B03002_014 | Hispanic or Latino, Black or African American alone | HoLB |
| B03002_015 | Hispanic or Latino, American Indian and Alaska Native alone | HoLAIAN |
| B03002_016 | Hispanic or Latino, Asian alone | HoLA |
| B03002_017 | Hispanic or Latino, Native Hawaiian and other Pacific Islander alone | HoLNHOPI |
| B03002_018 | Hispanic or Latino, some other race alone | HoLSOR |
| B03002_019 | Hispanic or Latino, two or more races | HoLTOMR |
| B03002_020 | Hispanic or Latino, two races including some other race | HoLTRiSOR |
| B03002_021 | Hispanic or Latino, two races excluding some other race, and three or more races | HoLTReSOR |

*D* is a measure of the evenness of racial or ethnic residential segregation when comparing smaller geographical areas to larger ones within which the smaller geographical areas are located. *D* can range in value from 0 to 1 and represents the proportion of racial or ethnic subgroup members that would have to change their area of residence to achieve an even distribution within the larger geographical area under conditions of maximum segregation.

```{r james_taeuber_prep, results = 'hide'}
james_taeuber2010PA <- james_taeuber(
  geo_large = 'county',
  geo_small = 'tract',
  state = 'PA',
  year = 2010,
  subgroup = c('NHoLB', 'HoLB')
)

# Obtain the 2010 census counties from the 'tigris' package
county2010PA <- counties(state = 'PA', year = 2010, cb = TRUE)
# Remove first 9 characters from GEOID for compatibility with tigris information
county2010PA$GEOID <- substring(county2010PA$GEO_ID, 10) 

# Join the D values to the county geometry
PA2010james_taeuber <- county2010PA %>%
  left_join(james_taeuber2010PA$d, by = 'GEOID')
```

```{r james_taeuber_plot, fig.height = 4, fig.width = 7}
# Visualize the D values (2006-2010 5-year ACS) for Pennsylvania, U.S.A., counties 
ggplot() +
  geom_sf(
    data = PA2010james_taeuber,
    aes(fill = D),
    size = 0.05,
    color = 'white'
  ) +
  geom_sf(
    data = county2010PA,
    fill = 'transparent',
    color = 'white',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_viridis_c(limits = c(0, 1)) +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2006-2010 estimates') +
  ggtitle(
    'Dissimilarity Index (James & Taeuber)\nPennsylvania census tracts to counties',
    subtitle = 'Black population'
  )
```

#### Compute racial or ethnic Entropy (*H*)

Compute Entropy (2010-2014 5-year ACS) for Philadelphia, PA, metropolitan area from census tracts. This metric is based on based on Theil (1972; ISBN:978-0-444-10378-9) and [Theil & Finizza (1971)](https://doi.org/110.1080/0022250X.1971.9989795). Multiple racial or ethnic subgroups are available in the `theil()` function, including:

| ACS table source | racial or ethnic subgroup | character for `subgroup`arguments |
| -------------- | ------------- | ---------------- |
| B03002_002 | not Hispanic or Latino | NHoL |
| B03002_003 | not Hispanic or Latino, white alone | NHoLW |
| B03002_004 | not Hispanic or Latino, Black or African American alone | NHoLB |
| B03002_005 | not Hispanic or Latino, American Indian and Alaska Native alone | NHoLAIAN |
| B03002_006 | not Hispanic or Latino, Asian alone | NHoLA |
| B03002_007 | not Hispanic or Latino, Native Hawaiian and Other Pacific Islander alone | NHoLNHOPI |
| B03002_008 | not Hispanic or Latino, some other race alone | NHoLSOR |
| B03002_009 | not Hispanic or Latino, two or more races | NHoLTOMR |
| B03002_010 | not Hispanic or Latino, two races including some other race | NHoLTRiSOR |
| B03002_011 | not Hispanic or Latino, two races excluding some other race, and three or more races | NHoLTReSOR |
| B03002_012 | Hispanic or Latino | HoL |
| B03002_013 | Hispanic or Latino, white alone | HoLW |
| B03002_014 | Hispanic or Latino, Black or African American alone | HoLB |
| B03002_015 | Hispanic or Latino, American Indian and Alaska Native alone | HoLAIAN |
| B03002_016 | Hispanic or Latino, Asian alone | HoLA |
| B03002_017 | Hispanic or Latino, Native Hawaiian and other Pacific Islander alone | HoLNHOPI |
| B03002_018 | Hispanic or Latino, some other race alone | HoLSOR |
| B03002_019 | Hispanic or Latino, two or more races | HoLTOMR |
| B03002_020 | Hispanic or Latino, two races including some other race | HoLTRiSOR |
| B03002_021 | Hispanic or Latino, two races excluding some other race, and three or more races | HoLTReSOR |

*H* is a measure of the evenness of racial or ethnic residential segregation when comparing smaller geographical areas to larger ones within which the smaller geographical areas are located. *H* can range in value from 0 to 1 and represents the (weighted) average deviation of each smaller geographical unit from the larger geographical unit's "entropy" or racial and ethnic diversity, which is greatest when each group is equally represented in the larger geographical unit. *H* varies between 0, when all smaller geographical units have the same racial or ethnic composition as the larger geographical area (i.e., maximum integration), to a high of 1, when all smaller geographical units contain one group only (maximum segregation).

```{r theil_prep, results = 'hide'}
theil2014PA <- theil(
  geo_large = 'metro',
  geo_small = 'tract',
  state = c('PA', 'NJ', 'DE', 'MD', 'OH', 'WV', 'NY', 'CT'),
  year = 2014,
  subgroup = c('NHoLB', 'HoLB')
)

# Obtain the 2014 Combined Statistical Areas from the 'tigris' package
metro2014 <- metro_divisions(year = 2014)
# Obtain the 2014 state from the 'tigris' package
state2014 <- states(cb = TRUE)

# Join the SP values to the CSA geometries and filter for Georgia
PA2010theil <- metro2014 %>%
  left_join(theil2014PA$h, by = 'GEOID') %>%
  filter(!st_is_empty(.)) %>%
  filter(!is.na(H)) %>%
  st_filter(state2014 %>% filter(STUSPS == 'PA')) %>%
  st_make_valid()
```

```{r theil_plot, fig.height = 4, fig.width = 7}
# Visualize the H values (2010-2014 5-year ACS) for Pennsylvania, U.S.A., metro divisions 
ggplot() +
  geom_sf(
    data = PA2010theil,
    aes(fill = H)
  ) +
  geom_sf(
    data = state2014 %>% filter(STUSPS == 'PA'),
    fill = 'transparent',
    color = 'black',
    size = 0.2
  ) +
  theme_minimal() +
  scale_fill_viridis_c(limits = c(0, 1)) +
  labs(fill = 'Index (Continuous)', caption = 'Source: U.S. Census ACS 2010-2014 estimates') +
  ggtitle(
    'Entropy (Theil)\nCensus tracts to Metro Divisions in Pennsylvania',
    subtitle = 'Black population'
  )
```

```{r system}
sessionInfo()
```
